name: JSON Schema Draft 7
version: draft-7
versions:
  - version: draft-7
    url: https://tools.ietf.org/html/draft-handrews-json-schema-validation-01
prefix: JD7
namespace: io.apicurio.datamodels.models.jsonschema.vdraft7
# NOTES:
# - Keep everything in alphabetical order please
# - Release notes: https://json-schema.org/draft-07/json-schema-release-notes.html

root:
  type: SchemaR

typeAliases:

  - name: Schema
    type: ArraySchema|BooleanSchema|ComplexSchema|EmptySchema|IntegerSchema|NullSchema|NumberSchema|ObjectSchema|Reference|StringSchema
    unionRules:
      - unionType: ArraySchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: array
      - unionType: BooleanSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: boolean
      - unionType: ComplexSchema
        ruleType: IsJsonObjectWithPropertyTypes
        name: type
        jsonTypes: [ array ]
      - unionType: EmptySchema # TODO: Clashes with Reference. We need an AND operator.
        ruleType: IsJsonObjectWithoutPropertyName
        name: type
      - unionType: IntegerSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: integer
      - unionType: NullSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: "null"
      - unionType: NumberSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: number
      - unionType: ObjectSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: object
      - unionType: Reference
        ruleType: IsJsonObjectWithPropertyTypes
        name: $ref
        jsonTypes: [ string ]
      - unionType: StringSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: string
  - name: SchemaRExt
    type: ArraySchema|BooleanSchema|ComplexSchema|EmptySchema|IntegerSchema|NullSchema|NumberSchema|ObjectSchema|Reference|StringSchema|boolean
    unionRules:
      - unionType: ArraySchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: array
      - unionType: BooleanSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: boolean
      - unionType: ComplexSchema
        ruleType: IsJsonObjectWithPropertyTypes
        name: type
        jsonTypes: [ array ]
      - unionType: EmptySchema
        ruleType: IsJsonObjectWithoutPropertyName
        name: type
      - unionType: IntegerSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: integer
      - unionType: NullSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: "null"
      - unionType: NumberSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: number
      - unionType: ObjectSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: object
      - unionType: Reference
        ruleType: IsJsonObjectWithPropertyTypes
        name: $ref
        jsonTypes: [ string ]
      - unionType: StringSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: string
      - unionType: boolean
        ruleType: IsJsonTypes
        jsonTypes: [ boolean ]
  - name: Dependency
    type: EmptySchema|ObjectSchema|Reference|boolean|[string]
    unionRules:
      - unionType: EmptySchema
        ruleType: IsJsonObjectWithoutPropertyName
        name: type
      - unionType: ObjectSchema
        ruleType: IsJsonObjectWithPropertyValue
        name: type
        jsonType: string
        jsonValue: object
      - unionType: Reference
        ruleType: IsJsonObjectWithPropertyTypes
        name: $ref
        jsonTypes: [ string ]
      - unionType: boolean
        ruleType: IsJsonTypes
        jsonTypes: [ boolean ]
      - unionType: "[string]"
        ruleType: IsJsonTypes
        jsonTypes: [ array ]

traits:

  - name: AllOf
    properties:
      - name: allOf
        type: "[SchemaRExt]"

  - name: AnyOf
    properties:
      - name: anyOf
        type: "[SchemaRExt]"

  - name: Const
    properties:
      - name: const
        type: any

  - name: Definitions
    properties:
      - name: definitions
        type: "[any]"

  - name: Else
    properties:
      - name: else
        type: SchemaRExt

  - name: Enum
    properties:
      - name: enum
        type: "[any]"

  - name: If
    properties:
      - name: if
        type: SchemaRExt

  - name: Metadata
    transparent: true
    properties:
      - name: default
        type: any
      - name: description
        type: string
      - name: examples
        type: "[any]"
      - name: readOnly
        type: boolean
      - name: title
        type: string
      - name: writeOnly
        type: boolean
      - name: $comment
        type: string
      - name: $id
        type: string
      - name: $schema
        type: string

  - name: Not
    properties:
      - name: not
        type: SchemaRExt

  - name: Numeric
    transparent: true
    properties:
      - name: exclusiveMaximum
        type: number
      - name: exclusiveMinimum
        type: number
      - name: maximum
        type: number
      - name: minimum
        type: number
      - name: multipleOf
        type: integer

  - name: OneOf
    properties:
      - name: oneOf
        type: "[SchemaRExt]"

  - name: Then
    properties:
      - name: then
        type: SchemaRExt

entities:

  - name: ArraySchema
    traits:
      - AllOf
      - AnyOf
      - Const
      - Definitions
      - Else
      - Enum
      - If
      - Metadata
      - Not
      - OneOf
      - Then
    properties:
      - name: additionalItems
        type: SchemaRExt
      - name: contains
        type: SchemaRExt
      - name: items
        type: SchemaRExt|[SchemaRExt]
      - name: maxItems
        type: integer
      - name: minItems
        type: integer
      - name: type
        type: string
      - name: uniqueItems
        type: boolean
    propertyOrder:
      - $AllOf
      - $AnyOf
      - $Const
      - $Definitions
      - $Else
      - $Enum
      - $If
      - $Metadata
      - $Not
      - $OneOf
      - $Then
      - $this

  - name: BooleanSchema
    traits:
      - AllOf
      - AnyOf
      - Const
      - Definitions
      - Else
      - Enum
      - If
      - Metadata
      - Not
      - OneOf
      - Then
    properties:
      - name: type
        type: string
    propertyOrder:
      - $AllOf
      - $AnyOf
      - $Const
      - $Definitions
      - $Else
      - $Enum
      - $If
      - $Metadata
      - $Not
      - $OneOf
      - $Then
      - $this

  - name: ComplexSchema
    properties:
      - name: type
        type: "[string]"
      - name: "*"
        type: any
    propertyOrder:
      - $this

  - name: EmptySchema
    traits:
      - AllOf
      - AnyOf
      - Const
      - Definitions
      - Else
      - Enum
      - If
      - Metadata
      - Not
      - OneOf
      - Then
    properties: [ ]
    propertyOrder:
      - $AllOf
      - $AnyOf
      - $Const
      - $Definitions
      - $Else
      - $Enum
      - $If
      - $Metadata
      - $Not
      - $OneOf
      - $Then
      - $this

  - name: IntegerSchema
    traits:
      - AllOf
      - AnyOf
      - Const
      - Definitions
      - Else
      - Enum
      - If
      - Metadata
      - Not
      - Numeric
      - OneOf
      - Then
    properties:
      - name: type
        type: string
    propertyOrder:
      - $AllOf
      - $AnyOf
      - $Const
      - $Definitions
      - $Else
      - $Enum
      - $If
      - $Metadata
      - $Not
      - $Numeric
      - $OneOf
      - $Then
      - $this

  - name: NullSchema
    traits:
      - AllOf
      - AnyOf
      - Const
      - Definitions
      - Else
      - Enum
      - If
      - Metadata
      - Not
      - OneOf
      - Then
    properties:
      - name: type
        type: string
    propertyOrder:
      - $AllOf
      - $AnyOf
      - $Const
      - $Definitions
      - $Else
      - $Enum
      - $If
      - $Metadata
      - $Not
      - $OneOf
      - $Then
      - $this

  - name: NumberSchema
    traits:
      - AllOf
      - AnyOf
      - Const
      - Definitions
      - Else
      - Enum
      - If
      - Metadata
      - Not
      - Numeric
      - OneOf
      - Then
    properties:
      - name: type
        type: string
    propertyOrder:
      - $AllOf
      - $AnyOf
      - $Const
      - $Definitions
      - $Else
      - $Enum
      - $If
      - $Metadata
      - $Not
      - $Numeric
      - $OneOf
      - $Then
      - $this

  - name: ObjectSchema
    traits:
      - AllOf
      - AnyOf
      - Const
      - Definitions
      - Else
      - Enum
      - If
      - Metadata
      - Not
      - OneOf
      - Then
    properties:
      - name: additionalProperties
        type: "{SchemaRExt}"
      - name: dependencies
        type: "{Dependency}"
      - name: maxProperties
        type: integer
      - name: minProperties
        type: integer
      - name: patternProperties
        type: "{SchemaRExt}"
      - name: properties
        type: "{SchemaRExt}"
      - name: propertyNames
        type: EmptySchema|StringSchema|boolean
        unionRules:
          - unionType: EmptySchema
            ruleType: IsJsonObjectWithoutPropertyName
            name: type
          - unionType: StringSchema
            ruleType: IsJsonObjectWithPropertyValue
            name: type
            jsonType: string
            jsonValue: string
          - unionType: boolean
            ruleType: IsJsonTypes
            jsonTypes: [ boolean ]
      - name: required
        type: "[string]"
      - name: type
        type: string
    propertyOrder:
      - $AllOf
      - $AnyOf
      - $Const
      - $Definitions
      - $Else
      - $Enum
      - $If
      - $Metadata
      - $Not
      - $OneOf
      - $Then
      - $this

  - name: Reference
    traits:
      - Metadata
    properties:
      - name: $ref
        type: string
    propertyOrder:
      - $Metadata
      - $this

  - name: StringSchema
    traits:
      - AllOf
      - AnyOf
      - Const
      - Definitions
      - Else
      - Enum
      - If
      - Metadata
      - Not
      - OneOf
      - Then
    properties:
      - name: contentEncoding
        type: string
      - name: contentMediaType
        type: string
      - name: format
        type: string
      - name: maxLength
        type: integer
      - name: minLength
        type: integer
      - name: pattern
        type: string
      - name: type
        type: string
    propertyOrder:
      - $AllOf
      - $AnyOf
      - $Const
      - $Definitions
      - $Else
      - $Enum
      - $If
      - $Metadata
      - $Not
      - $OneOf
      - $Then
      - $this
